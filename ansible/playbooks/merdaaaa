  # Resolve Problema Ansible no Ubuntu

  provisioner "remote-exec" {

    inline = [

      "sudo apt install -y python"

    ]

    connection {

      type = "ssh"

      user = "${var.INSTANCE_USERNAME}"

      private_key = "${file("${var.PATH_TO_PRIVATE_KEY}")}"

    }

  }  

 

  # Ansible Na Jogada

  provisioner "local-exec" {

    command = "printf '[awsexample]\n ${aws_instance.example.public_ip} \n\n[awsexample:vars]\nansible_user=ubuntu\nansible_become=true' > /etc/ansible/hosts"

  }

  provisioner "local-exec" {

    command = "ansible-playbook /etc/ansible/playbooks/playbook.yml"

  }

}
